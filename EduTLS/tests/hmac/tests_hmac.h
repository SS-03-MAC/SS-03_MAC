#include "../../src/crypto/hash/hmac.h"
#include "../../src/crypto/hash/md5.h"

#include <cassert>
#include <cstddef>
#include <cstdint>
#include <cstdio>

int test_hmac_md5_vector_one() {
  hmac *m;
  md5 *h = new md5();

  h->init();

  uint8_t expected[16] = {0x92, 0x94, 0x72, 0x7a, 0x36, 0x38, 0xbb, 0x1c,
                          0x13, 0xf4, 0x8e, 0xf8, 0x15, 0x8b, 0xfc, 0x9d};
  uint8_t actual[16] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
  uint8_t key[16] = {0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b, 0x0b};

  m = new hmac(h, key, 16);

  m->sum(actual, (uint8_t *)"Hi There", 8);

  delete m;

  for (int i = 0; i < 16; i++) {
    assert(actual[i] == expected[i]);
  }

  return 0;
}

int test_hmac_md5_vector_two() {
  hmac *m;
  md5 *h = new md5();

  h->init();

  uint8_t expected[16] = {0x75, 0x0c, 0x78, 0x3e, 0x6a, 0xb0, 0xb5, 0x03,
                          0xea, 0xa8, 0x6e, 0x31, 0x0a, 0x5d, 0xb7, 0x38};
  uint8_t actual[16] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

  m = new hmac(h, (uint8_t *)"Jefe", 4);

  m->sum(actual, (uint8_t *)"what do ya want for nothing?", 28);

  delete m;

  for (int i = 0; i < 16; i++) {
    assert(actual[i] == expected[i]);
  }

  return 0;
}

int test_hmac_md5_vector_three() {
  hmac *m;
  md5 *h = new md5();

  h->init();

  uint8_t expected[16] = {0x56, 0xbe, 0x34, 0x52, 0x1d, 0x14, 0x4c, 0x88,
                          0xdb, 0xb8, 0xc7, 0x33, 0xf0, 0xe8, 0xb3, 0xf6};
  uint8_t actual[16] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
  uint8_t data[50] = {0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                      0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                      0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                      0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD};
  uint8_t key[16] = {0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA};

  m = new hmac(h, key, 16);

  m->sum(actual, data, 50);

  delete m;

  for (int i = 0; i < 16; i++) {
    assert(actual[i] == expected[i]);
  }

  return 0;
}
